# ۱
# استانداردهای کدنویسی و اصول در سی‌شارپ

هدف اصلی استانداردهای کدنویسی و اصول در C# این است که برنامه‌نویسان با تولید کدی که هم عملکرد بهتری دارد و هم نگهداری آن آسان‌تر است، در حرفه خود ارتقا یابند. در این فصل، به بررسی نمونه‌هایی از کدهای خوب در مقابل کدهای بد خواهیم پرداخت. این موضوع ما را به بحث درباره اینکه چرا به استانداردهای کدنویسی، اصول و متدولوژی‌ها نیاز داریم، سوق می‌دهد. سپس به بررسی قراردادهای نام‌گذاری، کامنت‌گذاری و فرمت‌بندی کد منبع، شامل کلاس‌ها، متدها و متغیرها خواهیم پرداخت.

یک برنامه بزرگ می‌تواند برای درک و نگهداری بسیار پیچیده و دشوار باشد. برای برنامه‌نویسان تازه‌کار، شناخت کد و درک عملکرد آن می‌تواند چشم‌اندازی دلهره‌آور باشد. تیم‌ها ممکن است در کار گروهی روی چنین پروژه‌هایی با مشکل مواجه شوند. و از دیدگاه تست، می‌تواند کارها را بسیار دشوار کند. به همین دلیل، بررسی خواهیم کرد که چگونه از ماژولار بودن (modularity) استفاده می‌کنید تا برنامه‌ها را به ماژول‌های کوچک‌تر تقسیم کنید که همگی با هم کار می‌کنند تا یک راه‌حل کاملاً کارآمد و قابل تست را ارائه دهند، که می‌تواند به صورت همزمان توسط چندین تیم روی آن کار شود و خواندن، درک و مستندسازی آن بسیار آسان‌تر است.

در پایان این فصل، به بررسی برخی از دستورالعمل‌های طراحی برنامه‌نویسی، شامل KISS، YAGNI، DRY، SOLID و تیغ اوکام (Occam's Razor) خواهیم پرداخت.

#### استانداردهای کدنویسی و اصول در سی‌شارپ

فصل ۱

مباحث زیر در این فصل پوشش داده خواهند شد:

+ نیاز به استانداردهای کدنویسی، اصول و متدولوژی‌ها

+ قراردادهای نام‌گذاری و متدها

+ کامنت‌ها و فرمت‌بندی

+ ماژولار بودن

+ KISS

+ YAGNI

+ DRY

+ SOLID

+ تیغ اوکام (Occam's Razor)

 اهداف یادگیری شما برای این فصل به شرح زیر است:

+ درک اینکه چرا کدهای بد تأثیر منفی بر پروژه‌ها می‌گذارند.

+ درک اینکه چگونه کدهای خوب تأثیر مثبتی بر پروژه‌ها دارند.

+ درک اینکه چگونه استانداردهای کدنویسی کیفیت کد را بهبود می‌بخشند و چگونه آنها را اعمال کنید.

+ درک اینکه چگونه اصول کدنویسی کیفیت نرم‌افزار را ارتقا می‌دهند.

+ درک اینکه چگونه متدولوژی‌ها به توسعه کدهای تمیز کمک می‌کنند.

+ پیاده‌سازی استانداردهای کدنویسی.

+ انتخاب راه‌حل‌هایی با کمترین فرضیات ممکن.

+ کاهش تکرار کد و نوشتن کد SOLID.

## الزامات فنی
برای کار بر روی کدهای این فصل، باید Visual Studio 2019 Community Edition یا نسخه‌های بالاتر را دانلود و نصب کنید. این IDE را می‌توانید از https://visualstudio.microsoft.com/ دانلود کنید.

کدهای این کتاب در https://github.com/PacktPublishing/Clean-Code-in-C- قرار دارند. من همه آنها را در یک solution واحد با هر فصل به عنوان یک پوشه solution قرار داده‌ام. کدهای مربوط به هر فصل را در پوشه فصل مربوطه پیدا خواهید کرد. اگر پروژه‌ای را اجرا می‌کنید، به یاد داشته باشید که آن را به عنوان پروژه Startup تعیین کنید.

## کد خوب در مقابل کد بد
هم کد خوب و هم کد بد کامپایل می‌شوند. این اولین چیزی است که باید درک کرد. نکته بعدی این است که کد بد به دلیلی بد است و به همین ترتیب، کد خوب نیز به دلیلی خوب است. بیایید در جدول مقایسه‌ای زیر به برخی از این دلایل نگاهی بیندازیم:

<div align="center">
  
  ![Conventions-UsedThis-Book](../../assets/image/01/Table%201-1.png) 
  
</div>

همینطور است! در بخش‌های بعدی، به این خواهیم پرداخت که چگونه این ویژگی‌ها و تفاوت‌های بین کدهای خوب و بد، بر عملکرد کد شما تأثیر می‌گذارند.

## کد بد
اکنون نگاهی اجمالی به هر یک از شیوه‌های کدنویسی بد که قبلاً فهرست کردیم خواهیم داشت و به طور خاص توضیح می‌دهیم که هر یک از این شیوه‌ها چگونه بر کد شما تأثیر می‌گذارند.

## تورفتگی نامناسب (Improper indentation)
تورفتگی نامناسب می‌تواند باعث شود خواندن کد واقعاً دشوار شود، به خصوص اگر متدها بزرگ باشند. برای اینکه کد برای انسان‌ها به راحتی قابل خواندن باشد، به تورفتگی مناسب نیاز داریم. اگر کد فاقد تورفتگی صحیح باشد، تشخیص اینکه کدام قسمت از کد متعلق به کدام بلوک است، بسیار دشوار خواهد بود.

به طور پیش‌فرض، Visual Studio 2019 کد شما را هنگام بسته شدن پرانتزها و براکت‌ها (آکولادها) به درستی فرمت و تورفتگی می‌دهد. اما گاهی اوقات، به اشتباه کد را فرمت می‌کند تا به شما هشدار دهد که کدی که نوشته‌اید حاوی یک استثنا است. اما اگر از یک ویرایشگر متن ساده استفاده می‌کنید، باید فرمت‌بندی خود را به صورت دستی انجام دهید.

کد دارای تورفتگی نادرست همچنین زمان‌بر برای تصحیح است و هدر دادن ناامیدکننده زمان برنامه‌نویسی است، در حالی که به راحتی می‌توان از آن اجتناب کرد. بیایید به یک مثال کد ساده نگاه کنیم:

```C#

public void DoSomething()
{
    for (var i = 0; i < 1000; i++)
    {
        var productCode = $"PRC000{i}";
        //...implementation
    }
}
```
کد بالا آنقدر هم خوب به نظر نمی‌رسد، با این حال هنوز قابل خواندن است. اما هرچه خطوط کد بیشتری اضافه کنید، خواندن کد دشوارتر می‌شود.

جا انداختن یک براکت بسته بسیار آسان است. اگر کد شما به درستی تورفتگی نداشته باشد، یافتن براکت گم‌شده بسیار دشوارتر می‌شود، زیرا نمی‌توانید به راحتی تشخیص دهید که کدام بلوک کد براکت بسته‌اش را گم کرده است.

## کامنت‌هایی که بدیهیات را بیان می‌کنند (Comments that state the obvious)
من دیده‌ام که برنامه‌نویسان واقعاً از کامنت‌هایی که بدیهیات را بیان می‌کنند عصبانی می‌شوند، زیرا آنها را تحقیرآمیز می‌دانند. در بحث‌های برنامه‌نویسی که من در آنها شرکت کرده‌ام، برنامه‌نویسان اظهار داشته‌اند که چقدر از کامنت‌ها بیزارند و چگونه معتقدند که کد باید خود-مستندساز (self-documenting) باشد.

من احساسات آنها را درک می‌کنم. اگر می‌توانید کد را بدون کامنت بخوانید، مانند زمانی که یک کتاب را می‌خوانید و آن را درک می‌کنید، پس آن یک قطعه کد واقعاً خوب است. اگر یک متغیر به عنوان رشته (string) اعلان شده است، پس چرا کامنتی مانند // string اضافه کنید؟ بیایید به یک مثال نگاه کنیم:

```C#

public int _value; // This is used for storing integer values.
```
در اینجا می‌دانیم که value یک عدد صحیح را توسط نوع int خود نگه می‌دارد. بنابراین واقعاً نیازی به بیان بدیهیات نیست. تنها کاری که انجام می‌دهید هدر دادن زمان و انرژی و شلوغ کردن کد است.

## کامنت‌هایی که کد بد را توجیه می‌کنند (Comments that excuse bad code)
ممکن است مهلت تنگی برای رسیدگی داشته باشید، اما کامنت‌هایی مانند // I know this code sucks but hey at least it works! واقعاً وحشتناک هستند. این کار را نکنید. این نشان‌دهنده عدم حرفه‌ای‌گری است و می‌تواند واقعاً باعث نارضایتی همکاران برنامه‌نویس شود.

اگر واقعاً برای اینکه چیزی را به سرعت کارساز کنید تحت فشار هستید، یک تیکت بازسازی (refactor ticket) ایجاد کنید و آن را به عنوان بخشی از یک کامنت TODO اضافه کنید، مانند // TODO: PBI23154 Refactor Code to meet company coding practices. سپس شما یا سایر توسعه‌دهندگانی که برای کار روی بدهی فنی (technical debt) تعیین شده‌اند، می‌توانند آن آیتم بک‌لاگ محصول (Product Backlog Item - PBI) را برداشته و کد را بازسازی (refactor) کنند.

در اینجا یک مثال دیگر آورده شده است:

```C#

...
int value = GetDataValue(); // This sometimes causes a divide by zero error. Don't know why!
...
```
این یکی واقعاً بد است. بسیار خب، از اینکه به ما اطلاع دادید خطاهای تقسیم بر صفر در اینجا رخ می‌دهند، متشکریم. اما آیا یک تیکت باگ (bug ticket) ایجاد کرده‌اید؟ آیا سعی کرده‌اید به ریشه مشکل برسید و آن را برطرف کنید؟ اگر هر کسی که فعالانه روی پروژه کار می‌کند به آن کد دست نزند، چگونه متوجه می‌شوند که کد مشکل‌دار در آنجا وجود دارد؟

در حداقل حالت، حداقل باید یک کامنت // TODO: در محل داشته باشید. سپس حداقل کامنت در لیست وظایف (Task List) ظاهر می‌شود تا توسعه‌دهندگان مطلع شده و روی آن کار کنند.

## خطوط کد کامنت‌شده (Commented-out lines of code)
اگر برای امتحان کردن چیزی، خطوط کد را کامنت می‌کنید (comment out)، اشکالی ندارد. اما اگر قصد دارید از کد جایگزین به جای کد کامنت‌شده استفاده کنید، قبل از اینکه آن را چک‌این کنید (check it in)، کد کامنت‌شده را حذف کنید. یک یا دو خط کامنت‌شده آنقدر هم بد نیست. اما وقتی خطوط زیادی از کد کامنت‌شده دارید، حواس‌پرتی ایجاد می‌کند و نگهداری کد را دشوار می‌کند؛ حتی می‌تواند منجر به سردرگمی شود:

```C#

/* No longer used as has been replaced by DoSomethinElse().
public void DoSomething()
{
    // ...implementation...
}
*/
```
چرا؟ فقط چرا؟ اگر جایگزین شده و دیگر مورد نیاز نیست، پس فقط آن را حذف کنید. اگر کد شما در سیستم کنترل نسخه (version control) است و نیاز دارید متد را برگردانید، همیشه می‌توانید تاریخچه فایل را مشاهده کرده و متد را برگردانید.
